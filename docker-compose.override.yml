version: '3.8'

services:
  # Proxy disabled due to host networking limitations
  # proxy:
  #   image: traefik:v3.0
  #   ...

  api:
    # Use base image to skip build and avoid network issues
    image: golang:1.24.4-alpine
    restart: "no"
    # Run using go run. We use sh -c to ensure environment is ready if needed.
    # Note: air is not installed in base image, so we use go run.
    command: sh -c "go run cmd/api/main.go"
    working_dir: /app
    volumes:
      - .:/app
    environment:
      - SMTP_HOST=localhost
      - SMTP_PORT=1025
      - SMTP_SENDER=noreply@example.com
    network_mode: "host"

  postgres:
    restart: "no"
    network_mode: "host"

  redis:
    restart: "no"
    network_mode: "host"

  pgadmin:
    restart: "no"
    network_mode: "host"
    environment:
      PGADMIN_LISTEN_PORT: 5050

  mailpit:
    image: axllent/mailpit
    restart: "no"
    network_mode: "host"
